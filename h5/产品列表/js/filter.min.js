var bizFilter={bizCateHtml:[],bizAttHtml:[],req_url:"category.php",filterElemId:"filter_content",_nodeDepth:0,otherAtts:[],atts:[],currentAtts:[],params:[],canceled:!1,closeDivCount:0,radioArr:{hasStock:"is_stock",displaySalesPromotion:"is_promo",displayOutlets:"is_outlets",displayMVip:"is_mvip",displayPreSell:"is_presell",displayDDSelf:"is_ddself"},init:function(){this.bindToggle($("#"+this.filterElemId));this.bindPriceFocus();this.initDom();this.bindGetSubCategories();this.bindRadioClick();this.bindAttClick();
this.bindAddClick();this.bindCancelClick();this.bindSubmitClick();this.initDivFixed();this.bindBackClick()},bindBackClick:function(){var a=document.referrer,b=window.location.href,c=this;-1!=a.indexOf("ddcategory.php")?$.cookie("_last_jumping_url",a,{expires:1}):this.validRedirectLoc(a)&&$.cookie("_last_jumping_url",a,{expires:1});$("a.search_back, a.xph_back").click(function(){b==$.cookie("_last_jumping_url")?null!=a?(a=c.addSid(a),window.location.href=c.validRedirectLoc(a)?a:c.addSid(ddTouchIndex)):
window.location.href=c.addSid(ddTouchIndex):$.cookie("_last_jumping_url")?window.location.href=c.addSid($.cookie("_last_jumping_url")):window.location.href=c.addSid(ddTouchIndex)})},validRedirectLoc:function(a){return!(-1!=a.indexOf("search.php")||-1!=a.indexOf("category.php"))},addSid:function(a){return-1==a.indexOf("sid=")?a+"?sid="+sid:a},initDivFixed:function(){var a=this,b=function(){"none"!=$("._next").css("display")&&$("div.filtrate_category").each(function(){"none"!=$(this).next().css("display")&&
$(this).children("a").hasClass("filtrate_category_show")&&a.divSticky($(this))})};$(document).bind("touchmove",b);$(window).scroll(b)},divSticky:function(a){var b=$(window).scrollTop(),c=a.next(),e=parseInt(c.offset().top)-parseInt(a.height()),d=parseInt(c.height())+parseInt(c.offset().top)-parseInt(a.height());b>e&&b<d?a.hasClass("fixed")||(a.attr("style","").addClass("fixed"),c.css("margin-top",a.height()),a.css("top","0")):a.hasClass("fixed")&&(a.removeClass("fixed"),c.css("margin-top",0))},initDom:function(){var a=
this.getQuerystringObj();this.req_url=0<window.location.href.indexOf("search.php")?"search.php":"category.php";"undefined"!=typeof a.cid&&""!=a.cid&&(!1!==a.cid.indexOf(".")&&(a.cid=a.cid.replaceAll(".","_")),$("a[cid="+a.cid+"]",$("#filter_category_list")).addClass("on"));for(var b in this.radioArr)"undefined"!=typeof a[this.radioArr[b]]&&1==a[this.radioArr[b]]&&$("#"+b).addClass("on");"undefined"!=typeof a.lp&&$("#lp",$("#filter_content")).val(a.lp);"undefined"!=typeof a.hp&&$("#hp",$("#filter_content")).val(a.hp);
this.partShow()},partShow:function(){var a=$("#filter_category_list"),b=$("#filter_1_list"),c=$("#filter_region_list");a.show().find("li").slice(4).hide();0==b.children("li.on").length&&b.show().children("li").slice(12).hide();0==c.children("li.on").length&&c.show().children("li").slice(12).hide()},brandPartShow:function(){$("#filter_1_list").show().children("li").slice(12).hide()},bindCancelClick:function(){var a=this;$("#clear_btn").click(function(){a.removeAttOnState();$("span.up_down").not(":first-of-type").each(function(){"\u5168\u90e8\u5c55\u5f00"!=
$(this).html()&&$(this).html("\u5168\u90e8")});$(".filtrate_category_show").click();$("#lp").val("");$("#hp").val("");for(var b in a.radioArr)$("#"+b).removeClass("on");b="undefined"!=typeof a.params.cid?a.params.cid:"";a.params=[];b&&(a.params.cid=b);a.otherAtts=[];a.canceled=!0})},bindSubmitClick:function(){var a=this;$("#submit_btn").click(function(){var b=a.getQuerystringObj();a.getSelectedAtt();var c=[],e="is_stock is_promo is_outlets is_mvip is_presell is_ddself".split(" ");for(d in b)if(a.canceled){if("keyword"==
d||"sid"==d||"req"==d||"cid"==d)c[d]=b[d]}else $.inArray(d,e)&&0==b[d]||(c[d]=b[d]);for(d in a.params)c[d]=a.params[d];"undefined"==typeof a.params.city&&"undefined"!=typeof c.city&&delete c.city;"undefined"==typeof a.params.brand&&"undefined"!=typeof c.brand&&delete c.brand;"undefined"!=typeof c.brand&&0==c.brand.length&&delete c.brand;for(var d in a.radioArr)0==c[a.radioArr[d]]&&delete c[a.radioArr[d]];""!=$("#lp").val()?c.lp=$("#lp").val():delete c.lp;""!=$("#hp").val()?c.hp=$("#hp").val():delete c.hp;
b="?";for(d in c)"att"!=d&&("cid"==d&&(c[d]=c[d].replaceAll("_",".")),"brand"==d&&$.isArray(c[d])&&(c[d]=c[d].join(",")),b+=d+"="+c[d]+"&");b=b.substr(0,b.length-1);0<a.getAsocArrSize(a.otherAtts)&&(b+="&att="+a.getOtherAttsStr());window.location.href=searchUrl+a.req_url+(b+"&from=filter");return!1})},bindRadioClick:function(){var a=this;$("div.filtrate_has>ul>li").click(function(){var b=$(this).hasClass("on")?0:1;$(this).toggleClass("on");var c=$(this).attr("id");a.params[a.radioArr[c]]=b})},getSelectedAtt:function(){var a=
this;$("ul.att_item>li,ul.addr_item>li").each(function(){if($(this).hasClass("on")){var b=$(this).children("a").attr("cid"),c=$(this).parent().prev().attr("att_id");1==c?($.isArray(a.params.brand)||(a.params.brand=[]),-1==a.params.brand.indexOf(b)&&a.params.brand.push(b)):"address"==c?a.params.city=b:($.isArray(a.otherAtts[c])||(a.otherAtts[c]=[]),-1==a.otherAtts[c].indexOf(b)&&a.otherAtts[c].push(b))}})},bindAttClick:function(){$("ul.att_item>li").click(function(){$(this).toggleClass("on")})},bindAddClick:function(){$("ul.addr_item>li").click(function(){$(this).toggleClass("on");
$(this).siblings().removeClass("on")})},getAttNameStr:function(a){var b=[];a.find("li").each(function(){var a=$(this).children("a");if($(this).hasClass("on")||a.hasClass("on"))null!=a.attr("cname")?b.push(a.attr("cname")):b.push(a.attr("aname"))});a=b.join(",");return 0==b.length?"\u6536\u8d77":a},removeOnState:function(){$("a",$("#filter_category_list")).removeClass("on")},removeAttOnState:function(a){"undefined"!=typeof a?(a=a.parent().parent(),$("li",a).removeClass("on")):($("li",$(".att_item")).removeClass("on"),
$("li",$(".addr_item")).removeClass("on"))},getOtherAttsStr:function(){var a=[],b;for(b in this.otherAtts){var c=b.replaceAll("'","");if($.isArray(this.otherAtts[b]))for(var e in this.otherAtts[b]){var d=c+":"+this.otherAtts[b][e];-1==a.indexOf(d)&&a.push(d)}}return 0<a.length?a.join("-"):""},bindGetSubCategories:function(){var a=this;$("#"+this.filterElemId).children(".filtrate_list").eq(0);var b=$(".filtrate_price");$("#filter_category_list").click(function(c){var e=$(c.target);e.is("span")&&(e=
e.parent());var d=e.hasClass("on");a.removeOnState();e.addClass("on");var f=e.attr("cid");a.params.cid=f;if(e.hasClass("filtrate_list_li_a")&&e.hasClass("open"))e.removeClass("open"),"undefined"!=typeof a.bizCateHtml[f]&&(e.next("ul").remove(),d||(a.removeAllAtts(),$(a.bizAttHtml[f].brand).insertBefore(b),$(a.bizAttHtml[f].att).insertAfter(b),a.params.brand="",a.otherAtts=[],a.bindAttToggle(),a.bindAttClick(),a.brandPartShow()));else if(e.hasClass("filtrate_list_li_a")&&!e.hasClass("open")){if("undefined"==
typeof f||!f)return!1;c=a.getQuerystringObj();c.keyword&&(c.keyword=decodeURIComponent(c.keyword));c.cid=f.replaceAll("_",".");c.act="get_sub_categories";if("undefined"!=typeof a.bizCateHtml[f])return e.next("ul").remove(),e.addClass("open"),$(a.bizCateHtml[f]).insertAfter(e),d||(a.removeAllAtts(),$(a.bizAttHtml[f].brand).insertBefore(b),$(a.bizAttHtml[f].att).insertAfter(b),a.params.brand="",a.otherAtts=[],a.bindAttToggle(),a.bindAttClick(),a.brandPartShow()),!0;$.ajax({type:"GET",url:searchUrl+
a.req_url,data:c,dataType:"json",success:function(c){if(null!=c){var g="",h=a.getAttsHtml(c.att,f);0==c.category.length?a.params.cid=f:(e.addClass("open"),g=a.getCategoriesHtml(c.category,e),e.next("ul").remove(),$(g).insertAfter(e));d||(a.removeAllAtts(),$(h.brand).insertBefore(b),$(h.att).insertAfter(b),a.params.brand="",a.otherAtts=[],a.bizCateHtml[f]=g,a.bizAttHtml[f]=h,a.bindAttToggle(),a.bindAttClick(),a.brandPartShow())}}})}})},bindPriceFocus:function(){$("div.filtrate_price").children("input").focus(function(){$(this).toggleClass("foucs")}).blur(function(){$(this).toggleClass("foucs")})},
bindToggle:function(a){var b=this;$(".filtrate_category,.filtrate_category_a",a).click(function(){$(this).hasClass("filtrate_category_show")?($(this).parent().removeClass("fixed"),$(this).parent().next(".filtrate_list").css("margin-top","0").hide(),$(this).removeClass("filtrate_category_show"),$(this).children("span").text(b.getAttNameStr($(this).parent().next(".filtrate_list"))),"\u6536\u8d77"==$(this).children("span").html()&&$(this).children("span").html("\u5168\u90e8")):($(this).parent().removeClass("fixed"),
$(this).parent().next(".filtrate_list").show(),$(this).addClass("filtrate_category_show"),$(this).children("span").html("\u6536\u8d77"),$(this).parent().next(".filtrate_list").find("li").show())})},bindAttToggle:function(){this.bindToggle($("div[att_id]").not("[att_id='address']"));this.bindToggle($("ul.att_item"))},removeAllAtts:function(){for(var a=$("#"+this.filterElemId).children(".filtrate_category"),b=0;b<a.length;b++){var c=$(a[b]).next();0!=b&&b!=a.length-1&&($(a[b]).remove(),c.remove())}},
getQuerystringObj:function(){var a={},b=window.location.search.slice(1).split("&");for(i in b){var c=b[i].split("=");a[decodeURIComponent(c[0])]=c[1]}return a},getCategoriesHtml:function(a,b){if(0==a.length)return"";var c="<ul>",e=parseInt(b.css("padding-left").replace("px",""));if("undefined"!=typeof a)for(i in a)c+='<li class="filtrate_list_li"><a style="padding-left:'+(e+20)+'px" class="filtrate_list_li_a" cid="'+a[i].cid+'" cname="'+a[i].cname+'" href="javascript:;">'+a[i].cname+"</a></li>";return c+
"</ul>"},getAttsHtml:function(a,b){if(null==a||0==a.length)return"";var c=[],e={brand:"",att:""};if("undefined"!=typeof a)for(i in a){var d="",f=a[i].items;c.push(a[i].id);var k=1==a[i].id?"\u5168\u90e8\u5c55\u5f00":"\u5168\u90e8",d=d+('<div class="filtrate_category" att_id="'+a[i].id+'"><a class="filtrate_category_a" href="javascript:;">'+a[i].name);if(0==f.length)d+="</a></div>";else{d+='<span class="up_down">'+k+"</span></a></div>";d+='<ul class="clearfix filtrate_address filtrate_list att_item" id="filter_'+
a[i].id+'_list">';for(j in f)d+='<li><a href="javascript:;" cid="'+f[j].id+'" aname="'+f[j].name+'">'+f[j].name+"</a></li>";d+="</ul>"}1==a[i].id?e.brand=d:e.att+=d}this.currentAtts=c;this.atts[b]=c;return e},getAsocArrSize:function(a){var b=0;for(key in a)a.hasOwnProperty(key)&&b++;return b}};
